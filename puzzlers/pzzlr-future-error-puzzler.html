<h1>An Exceptional Future</h1>
<table class="table meta-table table-condensed">
  <tbody>
    <tr>
      <td class="header-column"><strong>Contributed by</strong></td>
      <td>Andy Wortman</td>
    </tr>
    <tr>
      <td><strong>Source</strong></td>
      <td><a target="_blank" href="#">N/A</a></td>
    </tr>
    <tr>
      <td><strong>First tested with Scala version</strong></td>
      <td>2.11.4</td>
    </tr>
  </tbody>
</table>
<div class="code-snippet">
  <h3>What is the result of executing the following code?</h3>
<pre class="prettyprint lang-scala">
import scala.concurrent.Future
import scala.concurrent.ExecutionContext.Implicits.global
import scala.util.{Failure, Success}

val f = Future({ throw new Error("bang!") }) recoverWith { 
  case ex: Exception => Future.successful("Not so bad: " + ex.getMessage)
}
f onComplete {
  case Success(res) => println("Yay: " + res)
  case Failure(e) => println("Oops: " + e.getMessage)
}
</pre>
  <ol>
    <li>Prints:
<pre class="prettyprint lang-scala">
Yay: Not so bad: bang!
</pre>
    </li>
    <li>Throws an exception</li>
    <li>Prints:
<pre class="prettyprint lang-scala">
Oops: bang!
</pre>
    </li>
    <li id="correct-answer">Prints:
<pre class="prettyprint lang-scala">
Yay: Not so bad: Boxed Error
</pre>
    </li>
  </ol>
</div>
<button id="show-and-tell" class="btn btn-primary" href="#">Display the correct answer, explanation and comments</button>
<div id="explanation" class="explanation" style="display:none">
  <h3>Explanation</h3>
  <p>
    scala.concurrent.Future attempts to catch and box Errors thrown from a Future's computation,
    turning our initial Future.failed(java.lang.Error("bad things")) into a
    Future.failed(java.util.concurrent.ExecutionException("Boxed Error", java.lang.Error("bad things"))).

    ExecutionException, to no surprise, is an Exception, so recoverWith's partial function matches and recovers to a Future.successful.
    Then, when Scala tries to match the result against Some(Failure(_)), it fails because oops.value is really Some(Success("tis but a flesh wound")).
    So in the end, Scala throws scala.MatchError: Some(Success(tis but a flesh wound)) (of class scala.Some).
  </p>
</div>